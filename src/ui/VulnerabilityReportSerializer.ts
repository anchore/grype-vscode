import * as vscode from "vscode";
import { VulnerabilityReportView } from "./VulnerabilityReportView";
import { IGrypeFinding } from "../IGrypeFinding";

export class VulnerabilityReportSerializer
  implements vscode.WebviewPanelSerializer {
  private readonly vulnerabilityReportView: VulnerabilityReportView;
  private readonly getScanReport: () => IGrypeFinding[] | null;

  constructor(
    vulnerabilityReportView: VulnerabilityReportView,
    getScanReport: () => IGrypeFinding[] | null
  ) {
    this.vulnerabilityReportView = vulnerabilityReportView;
    this.getScanReport = getScanReport;
  }

  public async deserializeWebviewPanel(
    webviewPanel: vscode.WebviewPanel
  ): Promise<void> {
    // tell view class to update its panel reference to the new webviewPanel
    this.vulnerabilityReportView.Panel = webviewPanel;

    const findings = this.getScanReport();
    if (findings) {
      this.vulnerabilityReportView.setFindings(findings);
    }
  }
}
